<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Google</title>
    <style>
        /* --- CORE STYLES --- */
        * { box-sizing: border-box; touch-action: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background-color: #000; /* OLED Black */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            overflow: hidden;
            color: #fff;
        }

        /* --- LAYOUTS --- */
        #input-layer {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 10;
            display: flex; flex-direction: column;
        }

        /* The Shape Zones (Top/Mid/Bot) */
        .shape-zone {
            flex: 1; /* Split screen in 3 */
            width: 100%;
            border-bottom: 1px solid #222;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; color: #444; 
            opacity: 0; /* Invisible start */
            transition: opacity 0.2s;
            /* CRITICAL FIX: Ignore clicks on these until needed */
            pointer-events: none; 
        }

        /* The Reveal Screen */
        #reveal-layer {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background: #000;
            display: none;
            flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 20;
            padding: 20px;
        }

        #primary-word {
            font-size: 3.5rem; font-weight: 800; text-transform: uppercase;
            text-align: center; margin-bottom: 10px; color: #fff;
        }
        #alt-words { font-size: 1.1rem; color: #666; text-align: center; max-width: 90%; }
        
        #status {
            position: absolute; bottom: 30px; left: 0; width: 100%;
            text-align: center; color: #333; font-size: 14px; pointer-events: none;
            transition: color 0.2s;
        }
    </style>
</head>
<body>

    <div id="input-layer">
        <div class="shape-zone" id="top-zone" data-shape="S">STRAIGHT</div>
        <div class="shape-zone" id="mid-zone" data-shape="C">CURVED</div>
        <div class="shape-zone" id="bot-zone" data-shape="M">MIXED</div>
    </div>

    <div id="status">Loading Database...</div>

    <div id="reveal-layer">
        <div style="color:#555; margin-bottom:20px;">Top Result</div>
        <div id="primary-word">...</div>
        <div id="alt-words"></div>
    </div>

<script>
    // --- CONFIGURATION ---
    const TAP_TIMEOUT = 1200; // 1.2 Seconds to wait after tapping
    const MIN_WORD_LEN = 3;

    // --- VARIABLES ---
    let phase = 1; // 1=Vowel1, 2=Vowel2, 3=Shape1, 4=Shape2
    let inputs = { v1: 0, v2: 0, s1: '', s2: '' };
    let tapCount = 0;
    let tapTimer = null;
    let dictionary = {};

    // --- ELEMENTS ---
    const status = document.getElementById('status');
    const zones = document.querySelectorAll('.shape-zone');
    const inputLayer = document.getElementById('input-layer');

    // --- 1. SETUP & DICTIONARY ---
    async function init() {
        try {
            const res = await fetch('https://raw.githubusercontent.com/first20hours/google-10000-english/master/google-10000-english-no-swears.txt');
            const text = await res.text();
            
            text.split('\n').forEach(word => {
                if(word.length < MIN_WORD_LEN || word.length > 10) return;
                word = word.toUpperCase();
                
                const v = getVowels(word);
                let v1 = v[0] || 0; 
                let v2 = v[1] || 0;

                const s1 = getShape(word[0]);
                const s2 = getShape(word[word.length-1]);

                const key = `${v1}-${v2}-${s1}-${s2}`;
                if (!dictionary[key]) dictionary[key] = [];
                if (!dictionary[key].includes(word)) dictionary[key].push(word);
            });
            
            status.innerText = "Ready. Tap screen for Vowel 1.";
            status.style.color = "#444";
        } catch(e) {
            status.innerText = "Offline Mode (Dictionary Error)";
        }
    }

    // --- 2. INPUT HANDLER (THE FIX) ---
    inputLayer.addEventListener('touchstart', (e) => {
        // Always vibrate on touch
        if(navigator.vibrate) navigator.vibrate(20);

        // LOGIC SPLITTER
        if (phase === 1 || phase === 2) {
            // PHASE 1 & 2: RHYTHM TAPPING
            handleTapCount();
        } 
        else {
            // PHASE 3 & 4: ZONE TAPPING
            // We need to know WHICH zone was hit.
            // Since pointer-events are auto now, e.target will be the zone.
            const target = e.target;
            if(target.classList.contains('shape-zone')) {
                const shape = target.getAttribute('data-shape');
                handleShapeInput(shape);
            }
        }
    });

    // --- 3. RHYTHM LOGIC ---
    function handleTapCount() {
        clearTimeout(tapTimer);
        tapCount++;
        
        // Visual confirmation (Flash text white)
        status.innerText = `Count: ${tapCount}`;
        status.style.color = "#fff";
        
        tapTimer = setTimeout(() => {
            lockInCount();
        }, TAP_TIMEOUT);
    }

    function lockInCount() {
        if(navigator.vibrate) navigator.vibrate([40, 40]); // Double buzz = Locked

        if (phase === 1) {
            inputs.v1 = tapCount;
            phase = 2;
            tapCount = 0;
            status.innerText = `Locked (${inputs.v1}). Now Vowel 2.`;
            status.style.color = "#444";
        } 
        else if (phase === 2) {
            inputs.v2 = tapCount;
            phase = 3;
            tapCount = 0;
            status.innerText = `Locked (${inputs.v2}). Top=Str, Mid=Crv, Bot=Mix`;
            
            // CRITICAL: ENABLE ZONES NOW
            zones.forEach(z => {
                z.style.opacity = 0.2; // Show faint outline
                z.style.pointerEvents = "auto"; // Make clickable
            });
        }
    }

    // --- 4. SHAPE LOGIC ---
    function handleShapeInput(shape) {
        if (phase === 3) {
            inputs.s1 = shape;
            phase = 4;
            status.innerText = "Last Letter Shape?";
        } 
        else if (phase === 4) {
            inputs.s2 = shape;
            reveal();
        }
    }

    // --- 5. REVEAL LOGIC ---
    function reveal() {
        const key = `${inputs.v1}-${inputs.v2}-${inputs.s1}-${inputs.s2}`;
        const matches = dictionary[key];
        
        const rLayer = document.getElementById('reveal-layer');
        const pWord = document.getElementById('primary-word');
        const aWord = document.getElementById('alt-words');

        if (matches && matches.length > 0) {
            pWord.innerText = matches[0];
            aWord.innerText = matches.length > 1 ? "Also: " + matches.slice(1,8).join(", ") : "Exact Match";
        } else {
            pWord.innerText = "NO MATCH";
            aWord.innerText = `Code: ${key}`;
        }
        
        rLayer.style.display = 'flex';
        // Hide zones again
        zones.forEach(z => {
            z.style.opacity = 0;
            z.style.pointerEvents = "none";
        });
    }

    // --- 6. UTILS (SWIPE & RESET) ---
    
    // Swipe Left to SKIP Vowel 2
    let startX = 0;
    document.addEventListener('touchstart', e => startX = e.touches[0].clientX);
    document.addEventListener('touchend', e => {
        let endX = e.changedTouches[0].clientX;
        // Only valid if swiping left AND in phase 2
        if (startX - endX > 80 && phase === 2) {
            clearTimeout(tapTimer);
            inputs.v2 = 0; // Set to 0
            phase = 3;
            if(navigator.vibrate) navigator.vibrate([40, 40]);
            status.innerText = "Skipped V2. Shape Phase.";
            
            // Enable Zones
            zones.forEach(z => {
                z.style.opacity = 0.2;
                z.style.pointerEvents = "auto";
            });
        }
    });

    // Reset
    document.getElementById('reveal-layer').addEventListener('dblclick', () => {
        location.reload();
    });

    // Logic Helpers
    function getShape(char) {
        if (!char) return "S";
        const c = char.toUpperCase();
        if ("COSU".includes(c)) return "C"; 
        if ("BDGJPQR".includes(c)) return "M"; 
        return "S"; 
    }
    function getVowels(word) {
        const vowels = "AEIOU";
        let idx = [];
        [...word.toUpperCase()].forEach((c, i) => { if (vowels.includes(c)) idx.push(i + 1); });
        return idx;
    }

    init();

</script>
</body>
</html>
