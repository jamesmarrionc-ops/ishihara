<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Google</title>
    <style>
        /* CORE STYLES */
        * { box-sizing: border-box; touch-action: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background-color: #000; /* OLED Black */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            overflow: hidden;
            color: #fff;
        }

        /* INPUT LAYER */
        #input-layer {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 10;
            /* Flex layout to show zones in Shape Phase */
            display: flex;
            flex-direction: column; 
        }

        /* ZONES (Only visible/active during Shape Phase) */
        .shape-zone {
            flex: 1; /* Divide height by 3 */
            width: 100%;
            border-bottom: 1px solid #222;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; color: #444; opacity: 0; /* HIDDEN BY DEFAULT */
            transition: opacity 0.2s;
        }

        /* REVEAL SCREEN */
        #reveal-layer {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            background: #000;
            display: none;
            flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 20;
            padding: 20px;
        }

        #primary-word {
            font-size: 3.5rem; font-weight: 800; text-transform: uppercase;
            text-align: center; margin-bottom: 10px; color: #fff;
        }

        #alt-words { font-size: 1.1rem; color: #666; text-align: center; max-width: 90%; }
        
        /* STATUS BAR (Helper text) */
        #status {
            position: absolute; bottom: 20px; left: 0; width: 100%;
            text-align: center; color: #333; font-size: 12px; pointer-events: none;
            transition: color 0.3s;
        }
    </style>
</head>
<body>

    <div id="input-layer">
        <div class="shape-zone" id="top-zone" data-shape="S">STRAIGHT</div>
        <div class="shape-zone" id="mid-zone" data-shape="C">CURVED</div>
        <div class="shape-zone" id="bot-zone" data-shape="M">MIXED</div>
    </div>

    <div id="status">Loading...</div>

    <div id="reveal-layer">
        <div style="color:#555; margin-bottom:20px;">Top Result</div>
        <div id="primary-word">...</div>
        <div id="alt-words"></div>
    </div>

<script>
    // --- 1. CONFIG ---
    const TAP_TIMEOUT = 1200; // Time (ms) to wait before confirming a tap count
    const MIN_WORD_LEN = 3;
    
    // --- 2. LOGIC ---
    function getShape(char) {
        if (!char) return "S";
        const c = char.toUpperCase();
        if ("COSU".includes(c)) return "C"; // Curved
        if ("BDGJPQR".includes(c)) return "M"; // Mixed
        return "S"; // Straight: A E F H I K L M N T V W X Y Z
    }

    function getVowels(word) {
        const vowels = "AEIOU";
        let idx = [];
        [...word.toUpperCase()].forEach((c, i) => {
            if (vowels.includes(c)) idx.push(i + 1);
        });
        return idx;
    }

    // --- 3. DICTIONARY FETCH ---
    const dictionary = {};
    const status = document.getElementById('status');

    async function init() {
        try {
            const res = await fetch('https://raw.githubusercontent.com/first20hours/google-10000-english/master/google-10000-english-no-swears.txt');
            const text = await res.text();
            const words = text.split('\n');

            words.forEach(word => {
                if(word.length < MIN_WORD_LEN || word.length > 10) return;
                word = word.toUpperCase();
                
                const v = getVowels(word);
                let v1 = v[0] || 0; 
                let v2 = v[1] || 0; // 0 means "None"

                const s1 = getShape(word[0]);
                const s2 = getShape(word[word.length-1]);

                // Key Format: V1_V2_S1_S2 (e.g., "2-4-S-M")
                const key = `${v1}-${v2}-${s1}-${s2}`;
                
                if (!dictionary[key]) dictionary[key] = [];
                if (!dictionary[key].includes(word)) dictionary[key].push(word);
            });
            
            status.innerText = "Ready. Tap Screen for Vowel 1 Position.";
            status.style.color = "#444";
        } catch(e) {
            status.innerText = "Error loading dictionary.";
        }
    }

    // --- 4. INPUT HANDLER ---
    let phase = 1; // 1=V1 Count, 2=V2 Count, 3=S1 Shape, 4=S2 Shape
    let inputs = { v1:0, v2:0, s1:'', s2:'' };
    
    // Tapping Logic
    let tapCount = 0;
    let tapTimer = null;
    const layer = document.getElementById('input-layer');
    const zones = document.querySelectorAll('.shape-zone');

    layer.addEventListener('touchstart', (e) => {
        // PREVENT DEFAULT ZOOM
        if(e.target.id !== 'input-layer' && phase < 3) return; // Pass through if shape phase
        
        // VIBRATE
        if(navigator.vibrate) navigator.vibrate(30);

        // LOGIC SPLIT
        if (phase === 1 || phase === 2) {
            handleTapCount();
        } else {
            // In Shape Phase, we need to know WHICH zone was tapped
            let touchY = e.changedTouches[0].clientY;
            let height = window.innerHeight;
            let shape = "";
            
            if(touchY < height/3) shape = "S";      // Top
            else if(touchY < (height/3)*2) shape = "C"; // Mid
            else shape = "M";                       // Bot
            
            handleShapeInput(shape);
        }
    });

    // --- PHASE 1 & 2: RHYTHM COUNTING ---
    function handleTapCount() {
        clearTimeout(tapTimer);
        tapCount++;
        
        // Update Status for visual feedback (remove in performance)
        status.innerText = `Phase ${phase}: ${tapCount}`;
        status.style.color = "#fff";

        // Set timer to "Lock in" the number
        tapTimer = setTimeout(() => {
            confirmCount();
        }, TAP_TIMEOUT);
    }

    function confirmCount() {
        // LOCK IN THE NUMBER
        if(navigator.vibrate) navigator.vibrate([50, 50]); // Double buzz confirm
        
        if (phase === 1) {
            inputs.v1 = tapCount;
            phase = 2;
            tapCount = 0;
            status.innerText = "Locked. Now Phase 2: Vowel 2 Pos.";
        } else if (phase === 2) {
            inputs.v2 = tapCount;
            phase = 3;
            tapCount = 0;
            status.innerText = "Locked. Phase 3: First Letter Shape?";
            showZones(true); // Light up zones slightly
        }
    }

    // --- PHASE 3 & 4: SHAPE SELECTION ---
    function handleShapeInput(shape) {
        if (phase === 3) {
            inputs.s1 = shape;
            phase = 4;
            status.innerText = "Phase 4: Last Letter Shape?";
        } else if (phase === 4) {
            inputs.s2 = shape;
            reveal();
        }
    }

    function showZones(visible) {
        zones.forEach(z => z.style.opacity = visible ? 0.3 : 0);
    }

    // --- 5. REVEAL ---
    function reveal() {
        const key = `${inputs.v1}-${inputs.v2}-${inputs.s1}-${inputs.s2}`;
        const results = dictionary[key];
        
        const rLayer = document.getElementById('reveal-layer');
        const pWord = document.getElementById('primary-word');
        const aWord = document.getElementById('alt-words');

        if (results && results.length > 0) {
            pWord.innerText = results[0];
            aWord.innerText = results.length > 1 ? "Also: " + results.slice(1).join(", ") : "Exact Match";
        } else {
            pWord.innerText = "NO MATCH";
            aWord.innerText = `Code: ${key}`;
        }

        rLayer.style.display = 'flex';
        showZones(false);
    }

    // --- 6. RESET & SPECIAL GESTURES ---
    
    // Swipe Left to SKIP Vowel 2 (For words like "CAT" with only 1 vowel)
    let startX = 0;
    document.addEventListener('touchstart', e => startX = e.touches[0].clientX);
    document.addEventListener('touchend', e => {
        let endX = e.changedTouches[0].clientX;
        if (startX - endX > 100 && phase === 2) { 
            // Swipe Left Detected during Phase 2
            clearTimeout(tapTimer);
            inputs.v2 = 0; // 0 = No 2nd vowel
            phase = 3;
            status.innerText = "Skipped V2. Phase 3: First Letter Shape?";
            if(navigator.vibrate) navigator.vibrate([50, 50]); 
            showZones(true);
        }
    });

    // Double Tap Reveal to Reset
    document.getElementById('reveal-layer').addEventListener('touchstart', (e) => {
       if (e.detail === 2) return; // prevent double fire
    });
    document.getElementById('reveal-layer').addEventListener('dblclick', () => {
        location.reload(); 
    });

    init();

</script>
</body>
</html>
